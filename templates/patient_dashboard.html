<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MediLink - Patient Dashboard</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link rel="icon" type="image/png" href="{{ url_for('static', filename='cardiogram.png') }}">
<style>
/* نفس الـ CSS الخاص بالهوم */
:root {
    --primary:#2563eb; --primary-dark:#1d4ed8; --secondary:#64748b;
    --success:#10b981; --info:#0ea5e9; --warning:#f59e0b; --danger:#ef4444;
    --dark:#1e293b; --light:#f8fafc; --gray:#e2e8f0;
    --card-shadow:0 10px 25px -3px rgba(0,0,0,0.1),0 4px 6px -2px rgba(0,0,0,0.05);
}
*{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;}
body{background:linear-gradient(135deg,#f0f9ff 0%,#e0f2fe 100%);color:var(--dark);min-height:100vh;line-height:1.6;}
.container{max-width:1200px;margin:0 auto;padding:20px;}

.header{display:flex;justify-content:space-between;align-items:center;padding:20px 0;margin-bottom:30px;}
.logo{display:flex;align-items:center;gap:10px;font-size:1.8rem;font-weight:700;color:var(--primary);}
.logo i{font-size:2.2rem;}
.nav-links{display:flex;gap:25px;}
.nav-links a{text-decoration:none;color:var(--dark);font-weight:500;position:relative;}
.nav-links a::after{content:'';position:absolute;bottom:-5px;left:0;width:0;height:2px;background:var(--primary);transition:width 0.3s;}
.nav-links a:hover::after{width:100%;}

/* Hero */
.hero{text-align:center;padding:40px 20px;background:linear-gradient(135deg,var(--primary),var(--primary-dark));color:white;border-radius:20px;margin-bottom:50px;box-shadow:var(--card-shadow);}
.hero h1{font-size:2.6rem;margin-bottom:10px;}
.hero p{font-size:1.1rem;opacity:0.9;}

/* Cards */
.option-card{background:white;padding:30px;border-radius:16px;box-shadow:var(--card-shadow);margin-bottom:40px;}
.option-card h2, h3{color:var(--primary);margin-bottom:20px;text-align:center;}

/* Input styling */
input, select, textarea {
    padding:12px;
    width:100%;
    border:1px solid var(--gray);
    border-radius:8px;
    font-size:1rem;
}

/* Button */
.btn-primary{
    background:var(--primary);
    color:white;
    border:none;
    padding:14px;
    width:100%;
    border-radius:10px;
    font-size:1.1rem;
    cursor:pointer;
    transition:0.3s;
}
.btn-primary:hover{background:var(--primary-dark);}

/* Table */
table { width:100%; border-collapse:collapse; }
thead tr{ background:var(--primary); color:white; }
td, th{ padding:12px; border-bottom:1px solid var(--gray); }

/* Footer */
.footer{text-align:center;padding:40px 20px;margin-top:60px;border-top:1px solid var(--gray);color:var(--secondary);}
.footer-links{display:flex;justify-content:center;gap:20px;margin:20px 0;}
.footer-links a{color:var(--secondary);text-decoration:none;}
.footer-links a:hover{color:var(--primary);}
</style>
</head>

<body>

<div class="container">

    <!-- Header -->
    <div class="header">
        <div class="logo"><i class="fas fa-heartbeat"></i> MediLink</div>
        <div class="nav-links">
            <a href="{{ url_for('index') }}">Home</a>
            <a href="{{ url_for('about_page') }}">About</a>
            <a href="{{ url_for('contact_page') }}">Contact</a>
            <a href="{{ url_for('logout') }}">Logout</a>

        </div>
    </div>

    <!-- Hero -->
    <div class="hero">
        <h1>Welcome, {{ patient_name }}</h1>
        <p>Manage your appointments and book new visits easily.</p>
    </div>

    <!-- Appointment Form -->
    <div class="option-card">
        <h2><i class="fas fa-calendar-plus"></i> Book New Appointment</h2>

        <form id="appointmentForm">
            <label>Doctor</label>
            <select id="doctor_id" required>
                <option value="">Select Doctor</option>
                {% for d in doctors %}
                <option value="{{ d.id }}">{{ d.name }} — {{ d.specialty }}</option>
                {% endfor %}
            </select>

            <label style="margin-top:15px;">Date & Time</label>
            <input type="datetime-local" id="date" required>

            <label style="margin-top:15px;">Reason</label>
            <textarea id="reason" rows="3" placeholder="Describe your symptoms..."></textarea>

            <button class="btn-primary" type="submit" style="margin-top:20px;">Book Appointment</button>
        </form>
    </div>

    <!-- Appointments List -->
    <div class="option-card">
        <h3><i class="fas fa-list"></i> Your Appointments</h3>

        <table>
            <thead>
                <tr>
                    <th>Doctor</th>
                    <th>Specialty</th>
                    <th>Date</th>
                    <th>Reason</th>
                </tr>
            </thead>
            <tbody>
                {% for appt in appointments %}
                <tr>
                    <td>{{ appt.doctor_name }}</td>
                    <td>{{ appt.doctor_specialty }}</td>
                    <td>{{ appt.date }}</td>
                    <td>{{ appt.reason or "—" }}</td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="4" style="text-align:center;">No appointments yet.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Footer -->
    <div class="footer">
        <p>&copy; 2025 MediLink. All rights reserved.</p>
    </div>

</div>

<script>
document.getElementById('appointmentForm').addEventListener('submit', async(e)=>{
    e.preventDefault();

    const doctor_id = document.getElementById('doctor_id').value;
    const date = document.getElementById('date').value;
    const reason = document.getElementById('reason').value;

    const res = await fetch('{{ url_for("book_appointment") }}', {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify({ doctor_id, date, reason })
    });

    const data = await res.json();

    if(res.ok){
        alert("Appointment booked!");
        location.reload();
    } else {
        alert(data.error || "Error booking appointment");
    }
});
</script>

</body>
</html>
