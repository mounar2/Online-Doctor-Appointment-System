<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MediLink - Doctor Dashboard</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link rel="icon" type="image/png" href="{{ url_for('static', filename='cardiogram.png') }}">
<style>
/* نفس ستايل Home */
:root {
    --primary:#2563eb; --primary-dark:#1d4ed8;
    --secondary:#64748b; --gray:#e2e8f0;
    --dark:#1e293b; --light:#f8fafc;
    --danger:#ef4444; --warning:#f59e0b; --success:#10b981;
    --card-shadow:0 10px 25px -3px rgba(0,0,0,0.1),0 4px 6px -2px rgba(0,0,0,0.05);
}

*{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',sans-serif;}
body{background:linear-gradient(135deg,#f0f9ff,#e0f2fe);min-height:100vh;color:var(--dark);}
.container{max-width:1200px;margin:auto;padding:20px;}

.header{display:flex;justify-content:space-between;align-items:center;padding:20px 0;}
.logo{display:flex;align-items:center;gap:10px;font-size:1.8rem;font-weight:700;color:var(--primary);}
.logo i{font-size:2.2rem;}
.nav-links{display:flex;gap:25px;}
.nav-links a{color:var(--dark);text-decoration:none;font-weight:500;position:relative;}
.nav-links a::after{content:'';position:absolute;bottom:-5px;left:0;width:0;height:2px;background:var(--primary);transition:.3s;}
.nav-links a:hover::after{width:100%;}

.hero{
    text-align:center;background:linear-gradient(135deg,var(--primary),var(--primary-dark));
    color:white;padding:40px 20px;border-radius:20px;margin-bottom:40px;box-shadow:var(--card-shadow);
}
.hero h1{font-size:2.4rem;margin-bottom:10px;}

.card{
    background:white;padding:25px;border-radius:16px;box-shadow:var(--card-shadow);
    margin-bottom:40px;
}

table{width:100%;border-collapse:collapse;margin-top:20px;}
thead{background:var(--primary);color:white;}
th,td{padding:12px;border-bottom:1px solid var(--gray);}

/* Badges */
.badge{padding:6px 10px;border-radius:8px;color:white;font-size:.9rem;}
.bg-warning{background:var(--warning);}
.bg-success{background:var(--success);}
.bg-danger{background:var(--danger);}

/* Buttons */
.btn{
    border:none;padding:8px 14px;border-radius:8px;color:white;
    cursor:pointer;font-size:.9rem;
}
.btn-success{background:var(--success);}
.btn-danger{background:var(--danger);}
.btn-success:hover{background:#0a986f;}
.btn-danger:hover{background:#d93636;}

.footer{text-align:center;margin-top:60px;color:var(--secondary);}
</style>
</head>

<body>

<div class="container">

    <!-- HEADER -->
    <div class="header">
        <div class="logo"><i class="fas fa-heartbeat"></i> MediLink</div>
        <div class="nav-links">
            <a href="{{ url_for('index') }}">Home</a>
            <a href="{{ url_for('about_page') }}">About</a>
            <a href="{{ url_for('contact_page') }}">Contact</a>
            <a href="{{ url_for('logout') }}">Logout</a>

        </div>
    </div>

    <!-- HERO SECTION -->
    <div class="hero">
        <h1>Welcome, Dr. {{ session.get('name') }}</h1>
        <p>Review and manage your patient appointments efficiently.</p>
    </div>

    <!-- MAIN DASHBOARD CARD -->
    <div class="card">
        <h2 style="color:var(--primary);text-align:center;">
            <i class="fas fa-calendar-check"></i> Pending Appointments
        </h2>

        <table>
            <thead>
                <tr>
                    <th>Patient</th>
                    <th>Date & Time</th>
                    <th>Reason</th>
                    <th>Status</th>
                    <th>Action</th>
                </tr>
            </thead>

            <tbody>
                {% for a in appointments %}
                <tr>
                    <td>{{ a.patient.name if a.patient else '' }}</td>
                    <td>{{ a.date }}</td>
                    <td>{{ a.reason or "-" }}</td>

                    <td>
                        {% if a.status == 'pending' %}
                        <span class="badge bg-warning">Pending</span>
                        {% elif a.status == 'accepted' %}
                        <span class="badge bg-success">Accepted</span>
                        {% else %}
                        <span class="badge bg-danger">Rejected</span>
                        {% endif %}
                    </td>

                    <td>
                        {% if a.status == 'pending' %}
                        <button class="btn btn-success"
                            onclick="respond('{{ a.id }}','accept')">Accept</button>

                        <button class="btn btn-danger"
                            onclick="respond('{{ a.id }}','reject')">Reject</button>
                        {% endif %}
                    </td>
                </tr>

                {% else %}
                <tr>
                    <td colspan="5" style="text-align:center;">No appointments found.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- FOOTER -->
    <div class="footer">
        <p>&copy; 2025 MediLink. All rights reserved.</p>
    </div>

</div>

<!-- JS -->
<script>
function respond(id, action) {
  fetch(`/api/appointment/${id}/doctor_response`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ action })
  })
  .then(res => res.json())
  .then(data => {
    if (data.message){
      alert(data.message);
      location.reload();
    } else {
      alert(data.error || 'Error');
    }
  });
}
</script>

</body>
</html>
